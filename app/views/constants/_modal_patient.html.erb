<div id="patient-modal"
     class="hidden fixed inset-0 bg-black/30 backdrop-blur-sm flex items-start justify-center p-4 z-50 overflow-y-auto"
     data-action="click->modal#handleBackdropClick">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md mt-20 p-6 relative">
    <button type="button"
            data-action="click->modal#close"
            class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
    <div class="flex flex-wrap items-start mt-6">
      <details class="bg-white p-4 rounded-lg shadow flex-1 relative" data-controller="filters" close>
        <summary class="flex items-center justify-between cursor-pointer">
          <div class="flex items-center space-x-3">
            <h2 class="font-size-6 font-semibold">Nuevo Paciente</h2>
            <span class="text-xs text-gray-500">(compacto — despliega para ver más)</span>
          </div>
          <svg data-filters-target="chevron" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.939l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.27a.75.75 0 01-.02-1.06z" clip-rule="evenodd" />
          </svg>
        </summary>

        <div class="mt-3">
          <%= turbo_frame_tag "patient_form" do %>
            <%= form_with(model: Patient.new,
                        data: {
                          controller: "form",
                          action: "turbo:submit-end->modal#handleSuccess turbo:submit-end->form#reset"
                        }) do |form| %>
              <div class="bg-white px-6 py-8 shadow rounded-lg">
                <div class="space-y-6">
                  <div class="mb-4">
                    <%= form.label :name, "Nombre", class: "block text-sm font-medium text-gray-700 mb-1" %>
                    <%= form.text_field :name, required: true,
                          class: "mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md transition duration-150 ease-in-out" %>
                  </div>

                  <div class="mb-4">
                    <%= form.label :gender, "Género", class: "block text-sm font-medium text-gray-700 mb-1" %>
                    <%= form.select :gender,
                          ["Masculino", "Femenino"],
                          { include_blank: "Seleccionar género" },
                          required: true,
                            class: "mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md transition duration-150 ease-in-out" %>
                  </div>

                  <div class="mb-6">
                    <%= form.label :age, "Edad", class: "block text-sm font-medium text-gray-700 mb-1" %>
                    <%= form.number_field :age, required: true, min: 0,
                          placeholder: "0.00",
                          class: "focus:border-indigo-500 flex-1 block w-full rounded-none rounded-l-md sm:text-sm border-gray-300" %>
                  </div>

                <div class="flex items-center justify-end mt-6 gap-2">
                    <%= form.submit "Guardar",
                          class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-[rgb(40_166_69)] hover:bg-[#2e8b57] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#007bfe] transition-colors duration-200shadow-outline" %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </details>
    </div>

    <div class="flex items-center justify-end mt-6 gap-2">
      <%= button_tag "Cancelar",
                        type: "button",
                        data: { action: "click->modal#close" },
                        class: "inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-white bg-[rgb(108_117_125)] hover:bg-[rgb(108_117_125)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#007bfe] transition-colors duration-200" %>
      <%= link_to patients_path,
                class: 'inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-colors duration-200' do %>
        <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z" />
        </svg>
        <span>Ver Pacientes</span>
      <% end %>
    </div>
  </div>
</div>
